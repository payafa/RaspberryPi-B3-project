# æ ‘è“æ´¾B3ç¡¬ä»¶æ§åˆ¶é¡¹ç›®

è¿™æ˜¯ä¸€ä¸ªåŸºäºæ ‘è“æ´¾B3çš„ç¡¬ä»¶æ§åˆ¶é¡¹ç›®ï¼Œä½¿ç”¨Cè¯­è¨€å’ŒWiringPiåº“å®ç°äº†å¤šä¸ªç”µå­å…ƒä»¶çš„æ§åˆ¶ï¼ŒåŒ…æ‹¬æŒ‰é’®æ£€æµ‹ã€TM1637å››ä½æ•°ç ç®¡æ—¶é’Ÿæ˜¾ç¤ºã€RGB LEDæ§åˆ¶ã€èœ‚é¸£å™¨æ§åˆ¶ç­‰åŠŸèƒ½ï¼Œå¹¶æä¾›äº†**Webç•Œé¢**å’Œå‘½ä»¤è¡Œä¸¤ç§æ§åˆ¶æ–¹å¼ã€‚

## ğŸŒŸ æ–°åŠŸèƒ½ï¼šWebç•Œé¢æ§åˆ¶

ç°åœ¨æ”¯æŒé€šè¿‡Webæµè§ˆå™¨è¿œç¨‹æ§åˆ¶ç¡¬ä»¶è®¾å¤‡ï¼

### Webç•Œé¢ç‰¹æ€§
- ğŸ“± **å“åº”å¼è®¾è®¡** - æ”¯æŒæ‰‹æœºã€å¹³æ¿ã€ç”µè„‘è®¿é—®
- ğŸ”„ **å®æ—¶æ•°æ®** - è‡ªåŠ¨åˆ·æ–°ä¼ æ„Ÿå™¨æ•°æ®
- ğŸ¨ **ç°ä»£åŒ–UI** - ç¾è§‚çš„ç•Œé¢è®¾è®¡
- ğŸš€ **RESTful API** - æ”¯æŒHTTP APIè°ƒç”¨
- âš¡ **å¿«é€Ÿå“åº”** - åŸºäºCè¯­è¨€çš„é«˜æ€§èƒ½æœåŠ¡å™¨

### å¿«é€Ÿå¼€å§‹
```bash
# ç¼–è¯‘Webç‰ˆæœ¬
make -f Makefile.web

# è¿è¡ŒWebæœåŠ¡å™¨
sudo ./web_main

# è®¿é—®Webç•Œé¢
http://localhost:8080
```

## é¡¹ç›®ç»“æ„

```
RaspberryPi-B3-project/
â”œâ”€â”€ main.c              # åŸå§‹å‘½ä»¤è¡Œä¸»ç¨‹åº
â”œâ”€â”€ web_main.c          # WebæœåŠ¡å™¨ä¸»ç¨‹åº
â”œâ”€â”€ Makefile            # åŸå§‹ç¼–è¯‘é…ç½®
â”œâ”€â”€ Makefile.web        # Webç‰ˆæœ¬ç¼–è¯‘é…ç½®
â”œâ”€â”€ web/                # WebæœåŠ¡å™¨æ¨¡å—
â”‚   â”œâ”€â”€ http_server.h   # HTTPæœåŠ¡å™¨å¤´æ–‡ä»¶
â”‚   â”œâ”€â”€ http_server.c   # HTTPæœåŠ¡å™¨å®ç°
â”‚   â”œâ”€â”€ api_handlers.c  # APIå¤„ç†å™¨
â”‚   â””â”€â”€ static/         # é™æ€Webæ–‡ä»¶
â”‚       â”œâ”€â”€ index.html  # ä¸»é¡µé¢
â”‚       â”œâ”€â”€ style.css   # æ ·å¼æ–‡ä»¶
â”‚       â””â”€â”€ script.js   # å‰ç«¯JavaScript
â”œâ”€â”€ components/         # ç¡¬ä»¶ç»„ä»¶æ¨¡å—
â”‚   â”œâ”€â”€ beep.c/.h       # èœ‚é¸£å™¨æ§åˆ¶
â”‚   â”œâ”€â”€ botton.c/.h     # æŒ‰é’®æ§åˆ¶
â”‚   â”œâ”€â”€ clock.c/.h      # TM1637æ•°ç ç®¡
â”‚   â”œâ”€â”€ rgb.c/.h        # RGB LEDæ§åˆ¶
â”‚   â”œâ”€â”€ DHT.c/.h        # æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨
â”‚   â”œâ”€â”€ usonic.c/.h     # è¶…å£°æ³¢ä¼ æ„Ÿå™¨
â”‚   â””â”€â”€ servo.c/.h      # èˆµæœºæ§åˆ¶
â”œâ”€â”€ combo/              # ç»„åˆåŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ alarm_clock.c/.h    # é—¹é’ŸåŠŸèƒ½
â”‚   â”œâ”€â”€ stopwatch.c/.h      # ç§’è¡¨åŠŸèƒ½
â”‚   â”œâ”€â”€ temp_display.c/.h   # æ¸©åº¦æ˜¾ç¤º
â”‚   â””â”€â”€ rgb_control.c/.h    # RGBæ§åˆ¶
â””â”€â”€ README.md           # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## ç¡¬ä»¶è¿æ¥

### å¼•è„šåˆ†é…è¡¨

| ç»„ä»¶ | å¼•è„šç±»å‹ | GPIOå¼•è„š | ç‰©ç†å¼•è„š |
|------|----------|----------|----------|
| æŒ‰é’® | è¾“å…¥ | GPIO 4 | Pin 7 |
| èœ‚é¸£å™¨ | è¾“å‡º | GPIO 18 | Pin 12 |
| TM1637æ—¶é’Ÿ CLK | è¾“å‡º | GPIO 27 | Pin 13 |
| TM1637æ—¶é’Ÿ DIO | è¾“å‡º | GPIO 22 | Pin 15 |
| RGB LED çº¢è‰² | è¾“å‡º | GPIO 16 | Pin 36 |
| RGB LED ç»¿è‰² | è¾“å‡º | GPIO 20 | Pin 38 |
| RGB LED è“è‰² | è¾“å‡º | GPIO 21 | Pin 40 |

## TODO List

### âœ… å·²å®ŒæˆåŠŸèƒ½
- [x] å®ç°æŒ‰é’®åŸºæœ¬æ¨¡å—
- [x] å®ç°èœ‚é¸£å™¨åŸºæœ¬æ¨¡å—
- [x] å®ç°æ•°ç ç®¡åŸºæœ¬æ¨¡å—
- [x] ç”¨æ•°ç ç®¡æ˜¾ç¤ºå®é™…æ—¶é—´(æ—¶:åˆ†)
- [x] å®ç°LEDåŸºæœ¬æ¨¡å—
- [x] å®ç°æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨æ¨¡å— (DHT11)
- [x] å®ç°è¶…å£°æ³¢è·ç¦»ä¼ æ„Ÿå™¨æ¨¡å—
- [x] å®ç°èˆµæœºæ§åˆ¶æ¨¡å—
- [x] **å®ç°Webç•Œé¢æ§åˆ¶** â­
- [x] **RESTful APIæ¥å£** â­
- [x] **å“åº”å¼å‰ç«¯è®¾è®¡** â­

### ğŸš§ ç»„åˆåŠŸèƒ½
- [x] å®ç°é—¹é’ŸåŠŸèƒ½ï¼ˆè®¾å®šé—¹é’Ÿæ—¶é—´ï¼Œåˆ°æ—¶é—´èœ‚é¸£å™¨å“é“ƒï¼ŒLEDé—ªçƒï¼‰
- [x] å®ç°ç§’è¡¨åŠŸèƒ½ï¼ˆæŒ‰é’®å¼€å§‹/æš‚åœ/é‡ç½®ï¼Œæ•°ç ç®¡æ˜¾ç¤ºè®¡æ—¶ï¼‰
- [x] å®ç°æ¸©åº¦æ˜¾ç¤ºåŠŸèƒ½ï¼ˆé›†æˆæ¸©åº¦ä¼ æ„Ÿå™¨ï¼Œæ•°ç ç®¡æ˜¾ç¤ºæ¸©åº¦ï¼‰
- [x] å®ç°æŒ‰é’®æ§åˆ¶RGBç¯é¢œè‰²åˆ‡æ¢

### ğŸ”® å¾…å¼€å‘åŠŸèƒ½
- [ ] æ·»åŠ é•¿æŒ‰æŒ‰é’®åŠŸèƒ½ï¼ˆåŒºåˆ†çŸ­æŒ‰å’Œé•¿æŒ‰æ“ä½œï¼‰
- [ ] å®ç°éŸ³ä¹æ’­æ”¾åŠŸèƒ½ï¼ˆèœ‚é¸£å™¨æ’­æ”¾ç®€å•æ—‹å¾‹ï¼‰
- [ ] WebSocketå®æ—¶é€šä¿¡
- [ ] æ·»åŠ æ‰‹æœºAPPè¿œç¨‹æ§åˆ¶
- [ ] æ·»åŠ å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨
- [ ] å®ç°æ•°æ®è®°å½•å’Œå›¾è¡¨æ˜¾ç¤º
- [ ] é›†æˆç‰©è”ç½‘åŠŸèƒ½ï¼ˆMQTTã€äº‘å¹³å°å¯¹æ¥ï¼‰

### ğŸ› ï¸ ä»£ç ä¼˜åŒ–
- [ ] æ·»åŠ é…ç½®æ–‡ä»¶æ”¯æŒï¼ˆä¿å­˜ç”¨æˆ·è®¾ç½®ï¼‰
- [ ] å®ç°éé˜»å¡å¼æŒ‰é’®æ£€æµ‹ï¼ˆä½¿ç”¨ä¸­æ–­ï¼‰
- [ ] æ·»åŠ é”™è¯¯æ—¥å¿—è®°å½•åŠŸèƒ½
- [ ] ä¼˜åŒ–å†…å­˜ä½¿ç”¨å’Œèµ„æºç®¡ç†
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•ç”¨ä¾‹

## ç¼–è¯‘å’Œè¿è¡Œ

### ç¯å¢ƒè¦æ±‚

- æ ‘è“æ´¾B3æˆ–æ›´é«˜ç‰ˆæœ¬
- Raspbian OS
- WiringPiåº“
- GCCç¼–è¯‘å™¨
- libcjsonåº“ (Webç‰ˆæœ¬)

### å®‰è£…ä¾èµ–

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update

# å®‰è£…ç¼–è¯‘å·¥å…·
sudo apt install build-essential

# å®‰è£…WiringPiåº“
sudo apt install wiringpi

# å®‰è£…cJSONåº“ (Webç‰ˆæœ¬éœ€è¦)
sudo apt install libcjson-dev

# éªŒè¯å®‰è£…
gpio -v
```

### ç¼–è¯‘é¡¹ç›®

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨Webç‰ˆæœ¬Makefileï¼ˆæ¨èï¼‰
```bash
# ç¼–è¯‘æ‰€æœ‰ç‰ˆæœ¬
make -f Makefile.web

# åªç¼–è¯‘Webç‰ˆæœ¬
make -f Makefile.web web-only

# åªç¼–è¯‘å‘½ä»¤è¡Œç‰ˆæœ¬
make -f Makefile.web main-only

# æ£€æŸ¥ä¾èµ–
make -f Makefile.web check-deps

# å®‰è£…ä¾èµ–
make -f Makefile.web install-deps
```

#### æ–¹å¼äºŒï¼šä½¿ç”¨åŸå§‹Makefile
```bash
# ç¼–è¯‘å‘½ä»¤è¡Œç‰ˆæœ¬
make

# æ¸…ç†ç¼–è¯‘æ–‡ä»¶
make clean
```

### è¿è¡Œç¨‹åº

#### Webç•Œé¢ç‰ˆæœ¬ï¼ˆæ¨èï¼‰
```bash
# è¿è¡ŒWebæœåŠ¡å™¨
sudo ./web_main

# ç„¶ååœ¨æµè§ˆå™¨ä¸­è®¿é—®
http://localhost:8080
```

#### å‘½ä»¤è¡Œç‰ˆæœ¬
```bash
sudo ./main
```

## ğŸŒ Web APIæ–‡æ¡£

### åŸºç¡€URL
```
http://localhost:8080/api/
```

### APIç«¯ç‚¹

#### 1. è·å–ç³»ç»ŸçŠ¶æ€
```http
GET /api/status
```
å“åº”ç¤ºä¾‹ï¼š
```json
{
  "status": "online",
  "timestamp": 1699123456,
  "components": {
    "rgb": "ready",
    "beep": "ready",
    "servo": "ready",
    "dht11": "ready",
    "ultrasonic": "ready",
    "clock": "ready"
  }
}
```

#### 2. è·å–ä¼ æ„Ÿå™¨æ•°æ®
```http
GET /api/sensors
```
å“åº”ç¤ºä¾‹ï¼š
```json
{
  "timestamp": 1699123456,
  "sensors": {
    "dht11": {
      "temperature": 23.5,
      "humidity": 60.2,
      "status": "success"
    },
    "ultrasonic": {
      "distance": 15,
      "status": "success"
    }
  }
}
```

#### 3. æ§åˆ¶RGB LED
```http
POST /api/rgb
Content-Type: application/json

{
  "action": "on",
  "color": "red"  // red, green, blue, white
}
```

```http
POST /api/rgb
Content-Type: application/json

{
  "action": "off"
}
```

#### 4. æ§åˆ¶èœ‚é¸£å™¨
```http
POST /api/beep
Content-Type: application/json

{
  "action": "beep",
  "duration": 1000  // æ¯«ç§’
}
```

#### 5. æ§åˆ¶èˆµæœº
```http
POST /api/servo
Content-Type: application/json

{
  "angle": 90  // 0-180åº¦
}
```

#### 6. è·å–è·ç¦»æ•°æ®
```http
GET /api/distance
```

### ä½¿ç”¨curlæµ‹è¯•API
```bash
# è·å–ç³»ç»ŸçŠ¶æ€
curl http://localhost:8080/api/status

# æ§åˆ¶RGB LED
curl -X POST -H "Content-Type: application/json" \
     -d '{"action":"on","color":"red"}' \
     http://localhost:8080/api/rgb

# æ§åˆ¶èœ‚é¸£å™¨
curl -X POST -H "Content-Type: application/json" \
     -d '{"action":"beep","duration":1000}' \
     http://localhost:8080/api/beep

# æ§åˆ¶èˆµæœº
curl -X POST -H "Content-Type: application/json" \
     -d '{"angle":45}' \
     http://localhost:8080/api/servo
```
gpio -v
```

### ç¼–è¯‘é¡¹ç›®

```bash
# ç¼–è¯‘é¡¹ç›®
make

# æ¸…ç†ç¼–è¯‘æ–‡ä»¶
make clean

# é‡æ–°ç¼–è¯‘
make rebuild
```

### è¿è¡Œç¨‹åº

```bash
# è¿è¡Œä¸»ç¨‹åºï¼ˆéœ€è¦rootæƒé™è®¿é—®GPIOï¼‰
sudo ./main_app
```

## å¼€å‘è¯´æ˜

### æ·»åŠ æ–°åŠŸèƒ½æ¨¡å—

1. åœ¨ `components/` ç›®å½•ä¸‹åˆ›å»º `.c` å’Œ `.h` æ–‡ä»¶
2. åœ¨å¤´æ–‡ä»¶ä¸­å®šä¹‰å¼•è„šå’Œå‡½æ•°æ¥å£
3. åœ¨æºæ–‡ä»¶ä¸­å®ç°å…·ä½“åŠŸèƒ½
4. æ›´æ–° `Makefile` ä¸­çš„æºæ–‡ä»¶åˆ—è¡¨
5. åœ¨ `main.c` ä¸­é›†æˆæ–°æ¨¡å—

### æ³¨æ„äº‹é¡¹

- ç¨‹åºä½¿ç”¨BCM GPIOç¼–å·æ¨¡å¼

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ã€‚
